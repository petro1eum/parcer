# PDF Document Structure Parser

Этот инструмент анализирует PDF-документы, извлекая их структуру (заголовки и содержимое разделов) с помощью GPT и сохраняя результаты в организованном виде.

## Основные возможности

1. Извлечение структуры документа:
   - Определение заголовков и их иерархии
   - Поиск пропущенных заголовков с помощью GPT
   - Извлечение текста разделов
   - Сохранение в иерархическую структуру папок

2. Поддерживаемые форматы:
   - PDF
   - DOCX (автоматическая конвертация в PDF)

## Установка

1. Клонируйте репозиторий
2. Установите зависимости:
```
pip install pdfplumber fitz openai
```

## Использование

```python
from parcer import main

# Для PDF файла
main(
    input_file="path/to/document.pdf",
    output_dir="path/to/output",
    start_page=1,
    end_page=10,
    is_docx=False,
    dpi=150
)

# Для DOCX файла
main(
    input_file="path/to/document.docx",
    output_dir="path/to/output",
    start_page=1,
    end_page=10,
    is_docx=True,
    dpi=150
)
```

## Структура выходных данных

```
output/
├── raw_gpt_structure.json    # Сырые данные от GPT
├── tables/                   # Извлеченные таблицы
│   ├── T1_название_таблицы.pdf
│   └── T2_название_таблицы.pdf
└── sections/                 # Разделы документа
    ├── 1/
    │   ├── section_1_Введение.txt
    │   └── 1/
    │       └── section_1.1_Термины.txt
    └── 2/
        └── section_2_Основные_положения.txt
```

## Как это работает

1. **Предварительная обработка**
   - Конвертация DOCX в PDF (если нужно)
   - Разбиение PDF на изображения для анализа

2. **Анализ структуры**
   - GPT анализирует каждую страницу
   - Определяет заголовки и их уровни
   - Находит таблицы

3. **Проверка пропущенных заголовков**
   - Анализ последовательности заголовков
   - Поиск пропущенных с помощью GPT
   - Верификация найденных заголовков

4. **Извлечение содержимого**
   - Извлечение текста между заголовками
   - Сохранение таблиц как отдельных PDF
   - Создание иерархической структуры папок

## Параметры

- \`input_file\`: путь к входному файлу (PDF или DOCX)
- \`output_dir\`: путь для сохранения результатов
- \`start_page\`: начальная страница для анализа
- \`end_page\`: конечная страница для анализа
- \`is_docx\`: флаг формата DOCX
- \`dpi\`: разрешение для конвертации страниц в изображения

## Особенности и ограничения

1. **Определение заголовков**
   - Использует GPT для анализа структуры
   - Проверяет пропущенные заголовки
   - Поддерживает многоуровневую иерархию

2. **Обработка таблиц**
   - Определяет многостраничные таблицы
   - Сохраняет каждую таблицу отдельно
   - Поддерживает сложные структуры

3. **Ограничения**
   - Зависит от качества PDF
   - Требует доступ к API OpenAI
   - Может пропускать сложные элементы форматирования

## Примеры использования

```python
# Базовый пример
main("document.pdf", "output", start_page=1, end_page=10)

# С конвертацией DOCX
main("document.docx", "output", start_page=1, end_page=10, is_docx=True)

# С высоким разрешением для сложных документов
main("document.pdf", "output", start_page=1, end_page=10, dpi=300)
```

## Решение проблем

1. **Пропущенные заголовки**
   - Проверьте лог на наличие предупреждений
   - Увеличьте DPI для лучшего распознавания
   - Проверьте качество исходного PDF

2. **Проблемы с таблицами**
   - Проверьте raw_gpt_structure.json
   - Убедитесь в качестве исходного документа
   - Проверьте связность многостраничных таблиц

## Разработка

Для добавления новых возможностей или исправления ошибок:

1. Форкните репозиторий
2. Создайте ветку для изменений
3. Внесите изменения
4. Создайте pull request

## Лицензия

MIT License
